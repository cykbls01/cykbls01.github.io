---
layout:     post
title:      MongoDB系列总结2
subtitle:   MongoDB基础知识
date:       2021-11-15
author:     Yikun Chen
header-img: img/background/header.png
catalog: true
tags:
    - mongodb
---


# MongoDB系列总结2

MongoDB 使用教程
--

## 基本操作

### 写入操作

``` 
db.collection.insertOne(<JSON对象>)   // 添加单个文档
db.collection.insertMany([{<JSON对象1>},{<JSON对象2>}])   // 批量添加文档
db.collection.insert()   // 添加单个文档

db.collection.insertOne(doc,{
writeConcern: // 安全级别，0代表不用关心，n代表复制到指定节点数才可以，majority代表大多数节点
})

db.demeDoc.insert(
{
  _id: {  product_name: 1,  product_type: 2},
supplierId:" 001",
create_Time: new Date()
}
)//复合主键
```
### 查询操作

``` 
db.inventory.find({})
db.inventory.find({}).pretty()

db.inventory.find( { status: "D" } );
db.inventory.find( { qty: 0 } );

db.inventory.find( { qty: 0, status: "D" } );

db.inventory.find( { "size.uom": "in" } );

db.inventory.find( { }, { item: 1, status: 1 } );


db.inventory.find({$and:[{"qty":0},{"status":"A"}]}).pretty(); 

db.inventory.find({$or:[{"qty":0},{"status":"A"}]}).pretty();

db.inventory.find({points:{ $gte:1000, $lte:2000}});

db.inventory.find({},{_id:0,nickName:1,points:1,tag: {  $elemMatch:  {$eq:  "00" } }});
```

### 更新操作

``` 
db.userInfo.updateMany({tag:"90"},{$set:{flag:1}});

db.userInfo.updateOne({tag:"90"},{$set:{flag:1}});

//db.collection.update( <query>,<update>,<options>)

db.doc.update({name:"zhangsan"},{$set:{ flag: 1 }},{multi:true});
```

### 删除操作

``` 
db.collection.remove(<query>,<options>)

db.collection.drop( { writeConcern:<doc>})
```



## 聚合操作

``` 
db.userInfo.aggregate({$project:{ name:"$nickName"}});

db.userInfo.aggregate({$match:{ nickName:"lisi"}});

db.userInfo.aggregate({$limit:1});

db.userInfo.aggregate({$skip:1}); 

db.userInfo.aggregate({$sort:{age:-1}});

db.sales.aggregate([{$group:{_id: "$item",avgAmount: { $avg: { $multiply: [ "$price", "$quantity" ] } },avgQuantity: { $avg: "$quantity" }}}])
```

参考文献
--

图灵学院java架构课程