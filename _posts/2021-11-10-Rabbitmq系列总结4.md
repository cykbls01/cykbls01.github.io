---
layout:     post
title:      Rabbitmq系列总结4
subtitle:   Rabbitmq进阶知识
date:       2021-11-10
author:     Yikun Chen
header-img: img/background/header.png
catalog: true
tags:
    - rabbitmq

---


# Rabbitmq系列总结4

Rabbitmq进阶知识
--

## 高级特性

### 消费端限流

当消费者处理速度跟不上的时候，要在消费端进行流量控制。在<rabbit:listener-container> 中配置 prefetch属性设置消费端一次拉取多少消息。消费端的确认模式一定为手动确认。acknowledge="manual"。

### TTL

TTL 全称 Time To Live（存活时间/过期时间）。当消息到达存活时间后，还没有被消费，会被自动清除。RabbitMQ可以对消息设置过期时间，也可以对整个队列（Queue）设置过期时间。

设置队列过期时间使用参数：x-message-ttl，单位：ms(毫秒)，会对整个队列消息统一过期。设置消息过期时间使用参数：expiration。单位：ms(毫秒)，当该消息在队列头部时（消费时），会单独判断这一消息是否过期。如果两者都进行了设置，以时间短的为准。

### 死信队列

死信队列，英文缩写：DLX 。Dead Letter Exchange（死信交换机），当消息成为Dead message后，可以被重新发送到另一个交换机，这个交换机就是DLX。当队列消息长度到达限制，或者消费者拒接消费消息，并且不把消息重新放入原目标队列。以及原队列存在消息过期设置，消息到达超时时间未被消费。这些情况会产生死信队列。给队列设置参数： x-dead-letter-exchange 和 x-dead-letter-routing-key可以绑定死信交换机。

### 延迟队列

延迟队列，即消息进入队列后不会立即被消费，只有到达指定时间后，才会被消费。RabbitMq不支持延迟队列，只有TTL+死信队列组合实现延迟队列的效果。


参考文献
--